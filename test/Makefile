
# compile using cmake
all:
	rm -rf build
	@mkdir -p build
	cd build && cmake .. 2>&1 1> /dev/null
	cd build && make all 2>&1 1> /dev/null
	
	@echo -e "\n\n\n\n\n"


# compile and then run tests
run: all
	@echo    "-------------------------------------------------------------------"
	@echo -e "-------------------------------------------- NO MPI NO VALG -------"
	@echo    "-------------------------------------------------------------------"
	su user -c "build/main"
	
	@echo    "-------------------------------------------------------------------"
	@echo -e "-------------------------------------------- 2 MPI NO VALG --------"
	@echo    "-------------------------------------------------------------------"
	su user -c "mpirun -np 2 build/main"
	
	@echo    "-------------------------------------------------------------------"
	@echo -e "-------------------------------------------- NO MPI WITH VALG -----"
	@echo    "-------------------------------------------------------------------"
	su user -c "valgrind build/main"
	
	@echo    "-------------------------------------------------------------------"
	@echo -e "-------------------------------------------- 2 MPI WITH VALG ------"
	@echo    "-------------------------------------------------------------------"
	su user -c "mpirun -np 2 valgrind build/main"
	
	@echo    "-------------------------------------------------------------------"
	@echo -e "-------------------------------------------- WITH VALG 2 MPI ------"
	@echo    "-------------------------------------------------------------------"
	su user -c "valgrind mpirun -np 2 build/main"
	
	@echo    "-------------------------------------------------------------------"
	@echo "All done"
